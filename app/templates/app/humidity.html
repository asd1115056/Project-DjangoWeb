{% extends "app/base.html" %}

{% block content %}
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.3.1/justgage.min.js"></script>

<div class="row clearfix">
    <div class="col-md-2 column">
        <div style="text-align:center;"><h3>Location</h3><br></div>
        <ul class="nav nav-pills nav-stacked">
            {% for app in apps %}
            <li {% if forloop.first %} class="active" {% endif %} location_id="{{app.location_id}}">
                <a data-toggle="tab" href="#{{app.location_id}}">{{app.location_id}}</a>
            </li>
            {% endfor %}
        </ul>
    </div>
    <div class="col-md-10 column">
        <div class="row clearfix">
            <div class="col-md-3 column">
                <div style="text-align:center;"><h3>Humidity</h3><br></div>
                <div id="gauge1" style=" height:150px"></div>
            </div>
            <div class="col-md-9 column">
                <br>
                <div id="container" style="min-width: 700px; height: 300px; margin: 0 auto"></div>
            </div>
        </div>
    </div>
</div>
<script>
    $(function () {
        var i;
        $("li").click(function () { //點擊事件
            location_id = $(this).attr('location_id'),
                i = location_id.localeCompare("undefined") //比較兩字串:相等=0
            if (i != 0) {//取不相等時的值
                data = { 'location_id': location_id }
                console.log(data);
            }
            $.ajax({
                url: "{% url 'env_get' %}",
                type: 'GET',
                data: data,
                success: function (response) {
                    console.log(response);
                    clearPlot()
                    requestData()
                    refresh()
                },
                error: function () {
                    console.log('something went wrong here');
                },
            });

        });
    });



    var gage;
    function refresh() {
        $.ajax({
            url: "{% url 'env_filter' %}",
            type: "GET",
            dataType: "json",
            success: function (data) {
                var len = Object.keys(data).length;
                var x = new Date(data[len - 1].fields.updated_at).getTime();
                var y = data[len - 1].fields.temperature;
                var max = 300;
                console.log([y, x]);

                if (!gage) {
                    gage = new JustGage({
                        id: "gauge1",
                        value: y,
                        min: 0,
                        max: 100,
                        label: "°%",
                    });
                } else {
                    gage.refresh(y);
                }
            }
        });
    }
    setTimeout(refresh, 100) //第一次刷新數據
</script>
{% endblock %}
