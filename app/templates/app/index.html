{% extends "app/base.html" %}
{% block content %}
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.3.1/justgage.min.js"></script>

<div class="row clearfix">
    <div class="col-md-2 column">
        <div style="text-align:center;"><h3>Nickname</h3><br></div>
        <ul class="nav nav-pills nav-stacked">
            {% for app in apps %}
            <li {% if forloop.first %} class="active" {% endif %} Tag="{{app.Tag}}">
                <a data-toggle="tab" href="">{% if app.nickname %} {{app.nickname}} {% else %} {{app.Tag}} {% endif %}</a>
            </li>
            {% endfor %}
        </ul>
    </div>
    <div class="col-md-10 column">
        <div class="row clearfix">
            <div class="col-md-3 column">
                <div style="text-align:center;"><h3>Pet info</h3><br></div>
                <table class="table">
                    <thead>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Tag</td>
                            <td id="Tag_table"></td>
                        </tr>
                        <tr>
                            <td>Category</td>
                            <td id="Category_table"></td>
                        </tr>
                        <tr>
                            <td>Weight</td>
                            <td id="Weight_table"></td>
                        </tr>
                        <tr>
                            <td>Statue</td>
                            <td id="statue_table"></td>
                        </tr>
                    </tbody>
                </table>
                <form role="form" id="form_test">
                    <!-- 按钮触发模态框 -->
                    <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">Setting</button>
                    <!-- 模态框（Modal） -->
                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="myModalLabel">Customize</h4>
                                </div>

                                <div class="modal-body">
                                    <div class="form-group">
                                        <label for="Nickname">Nickname</label>
                                        <input type="text" class="form-control" id="Nickname" placeholder="Lucky">
                                    </div>
                                    <div class="form-group">
                                        <label>Category</label>
                                        <select name="Category" id="Category" class="form-control" onChange="formcontroloption(this)">
                                            <option value="0" selected></option>
                                            <option value="1">Cat</option>
                                            <option value="2">Dog</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Status</label>
                                        <select name="Status" id="Status" class="form-control">
                                            <option value="0" selected></option>
                                            <optgroup id="cat1" label="Kitten">
                                                <option value="2.5">Kitten</option>
                                            </optgroup>
                                            <optgroup id="dog1" label="Puppy">
                                                <option value="3">0-4 months</option>
                                                <option value="2">4 months to adult</option>
                                            </optgroup>
                                            <optgroup id="cat2" label="Cat">
                                                <option value="1.4">Neutered</option>
                                                <option value="1.2">Intact</option>
                                                <option value="1.0">Inactive/obese prone</option>
                                                <option value="0.95">Weight loss</option>
                                            </optgroup>
                                            <optgroup id="dog2" label="Dog">
                                                <option value="1.6">Neutered</option>
                                                <option value="1.8">Intact</option>
                                                <option value="1.3">Inactive/obese prone</option>
                                                <option value="1.0">Weight loss</option>
                                                <option value="1.5">Weight gain</option>
                                                <option value="3.5">Active, working dogs</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="Weight">Weight</label>
                                        <input type="number" step="0.01" class="form-control" id="Weight" placeholder="5.5(kg)">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-default">Save</button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>
                </form>
                <form role="form" id="form_test1">
                    <!-- 按钮触发模态框 -->
                    <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal1">More</button>
                    <!-- 模态框（Modal） -->
                    <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModal1Label" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="myModal1Label">Customize</h4>
                                </div>
                                <div class="modal-body">
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-default">Save</button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>
                </form>
            </div>
            <div class="col-md-4 column">
                <div style="text-align:center;"><h3>Calorie</h3><br></div>
                <div id="gauge1" style=" height:150px;text-align:center"></div>
            </div>
            <div class="col-md-4 column">
                <div style="text-align:center;"><h3>Water</h3><br></div>
                <div id="gauge2" style=" height:150px;text-align:center"></div>
            </div>
            <div class="clearfix hidden-xs"></div>
        </div>
    </div>
</div>

<script>

    $(function () {
        var i;
        $("li").click(function () { //點擊事件
            Tag = $(this).attr('Tag'),
                i = Tag.localeCompare("undefined") //比較兩字串:相等=0
            if (i != 0) {//取不相等時的值
                data = { 'Tag': Tag }
                console.log(data);
            }
            $.ajax({
                url: "{%url 'pet_get_id'%}",
                type: 'GET',
                data: data,
                success: function (response) {
                    //console.log(response);
                    ajax_user_data();
                    ajax_tag_Info();
                    setTimeout(refresh, 200);
                    //refresh();
                },
                error: function () {
                    console.log('click:error!');
                }
            });
        });
    });
</script>

<script>
    function ajax_tag_Info() {
        $.ajax({
            url: "{%url 'Tag_Info'%}",
            type: "GET",
            dataType: "json",
            success: function (data) {
                console.log(data);
                $("#Tag_table").text(data[0].fields.Tag);
                $("#Weight_table").text(data[0].fields.weight);
                if (data[0].fields.category == 1) {
                    $("#Category_table").text("Cat");
                    if (data[0].fields.cat_statue == 0.95) { $("#statue_table").text("Weight loss(x0.95)"); }
                    else if (data[0].fields.cat_statue == 1.0) { $("#statue_table").text("Inactive/obese prone(x1.0)"); }
                    else if (data[0].fields.cat_statue == 1.2) { $("#statue_table").text("Intact(x1.2)"); }
                    else if (data[0].fields.cat_statue == 1.4) { $("#statue_table").text("Neutered(x1.4)"); }
                    else if (data[0].fields.cat_statue == 2.5) { $("#statue_table").text("Kitten(x2.5)"); }
                    else { $("#statue_table").text("Null"); }
                } else if (data[0].fields.category == 2) {
                    $("#Category_table").text("Dog");
                    if (data[0].fields.dog_statue == 1.0) { $("#statue_table").text("Weight loss(x1.0)"); }
                    else if (data[0].fields.dog_statue == 1.3) { $("#statue_table").text("Inactive/obese prone(x1.3)"); }
                    else if (data[0].fields.dog_statue == 1.5) { $("#statue_table").text("Weight gain(x1.5)"); }
                    else if (data[0].fields.dog_statue == 1.6) { $("#statue_table").text("Neutered(x1.6)"); }
                    else if (data[0].fields.dog_statue == 1.8) { $("#statue_table").text("Intact(x1.8)"); }
                    else if (data[0].fields.dog_statue == 2) { $("#statue_table").text("4 months to adult(x2)"); }
                    else if (data[0].fields.dog_statue == 3) { $("#statue_table").text("0-4 months(x3)"); }
                    else if (data[0].fields.dog_statue == 3.50) { $("#statue_table").text("Active, working dogs(x3.5)"); }
                    else { $("#statue_table").text("Null"); }
                } else {
                    $("#Category_table").text("Null");
                }

            },
            error: function () {
            }
        });
    }
</script>
<script>
    var max_w;
    var max_f;
    function ajax_user_data() {
        $.ajax({
            url: "{%url 'pet_filter_user_setting'%}",
            type: "GET",
            dataType: "json",
            success: function (data) {
                clear();
                max_w = data[0].fields.user_water_setting_daily;
                max_f = data[0].fields.user_food_setting_daily;
                debug = { 'max_w': max_w, 'max_f': max_f }
                //console.log(debug);

            },
            error: function () {
                clear();
                console.log('ajax_user_data:error!');
            }
        });
    }

    function clear() {
        max_f = 0;
        max_w = 0;
    }

    var gage1;
    var gage2;
    function refresh() {
        $.ajax({
            url: "{%url 'pet_filter_info'%}",
            type: "GET",
            dataType: "json",
            success: function (data) {
                var len = Object.keys(data).length;
                var x = 0;
                var y = 0;
                for (var i = 0; i < len; i++) {
                    x += parseFloat(data[i].fields.food_eat);
                    y += parseFloat(data[i].fields.water_drink);
                    //console.log([x, y]);
                }
                //console.log([x, y]);
                if (!gage1) {
                    gage1 = new JustGage({
                        id: "gauge1",
                        value: 0,
                        min: 0,
                        max: 0,
                        label: "kcal",
                    });
                } else {
                    gage1.refresh(x, max_f);
                }
                if (!gage2) {
                    gage2 = new JustGage({
                        id: "gauge2",
                        value: 0,
                        min: 0,
                        max: 0,
                        label: "mL",
                    });
                } else {
                    gage2.refresh(y, max_w);
                }
            }
        });
    }

    setTimeout(refresh, 100) //第一次刷新數據
</script>
<script>
    $(function () {
        $('#form_test').submit(function (e) {
            e.preventDefault();
            var Nickname = $("#Nickname").val();
            var Weight = $("#Weight").val();
            var Category = $("#Category").val();
            var Status = $("#Status").val();

            data = { 'Nickname': Nickname, 'Weight': Weight,'Category': Category,'Status':Status };
            console.log(data);
            $.ajax({
                type: "POST",
                url: "{% url 'json_test' %}",
                data: data,
                success: function (response) {
                    console.log(response);
                    alert('sucess');
                },
                error: function () {
                    alert("failure");
                }
            });
        });
    });
</script>
<script>

    function formcontroloption() {
        var Category = $("#Category").val();
        if (Category == "1") {
            $("#cat1").show();
            $("#cat2").show();
            $("#dog1").hide();
            $("#dog2").hide();
            //alert("test");
        }
        else if (Category == "2") {
            $("#cat1").hide();
            $("#cat2").hide();
            $("#dog1").show();
            $("#dog2").show();
        } else {
            $("#cat1").hide();
            $("#cat2").hide();
            $("#dog1").hide();
            $("#dog2").hide();

        }
    }
    $(function () {
        $("#cat1").hide();
        $("#cat2").hide();
        $("#dog1").hide();
        $("#dog2").hide();
    });
</script>

{% endblock %}